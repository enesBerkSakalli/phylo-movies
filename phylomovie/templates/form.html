<!DOCTYPE html>
<html lang="en">

<!-- Base HTML File written by Enes Berk Sakalli-->

<head>
    <meta charset="utf-8" />
    <title>Phylo-Movies</title>

    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- JavaScript Bundle with Popper -->

    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous">
    </script>

    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.15.22/dist/css/uikit.min.css" />

    <!-- UIkit JS -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.15.22/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.15.22/dist/js/uikit-icons.min.js"></script>

</head>

<body>

    <div>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">Â´

                <a class="navbar-brand" href="/">
                    Phylo-Movies
                </a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="./about">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="#">Help</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>

    <div class="container" style="margin-top:50px">
        <div class="row">
            <div class="header p-0">
                <h1>Phylo-Movies</h1><i class="fa fa-film logo icon-right"></i>
            </div>
        </div>

        <form method="post" enctype="multipart/form-data">
            <div class="form-group row">
                <label class="" for="windowSize">Window-Size</label>
                <input type="number" name="windowSize" id="windowSize" placeholder="1" value="1"
                    class="form-control form-control-lg">
            </div>

            <div class="form-group row">
                <label class="form-label col-form-label-lg" for="window-step-size">Window-Step-Size</label>
                <input type="number" id="window-step-size" name="windowStepSize" placeholder="1" value="1"
                    class="form-control form-control-lg">
            </div>

            <div class="form-group row">
                <label for="form-file-tree" class="form-label col-form-label-lg">Tree-File</label>
                <input onchange="createColorArray(event)" type="file" class="form-control form-control-lg" id="input-file-tree" name="treeFile" required >
            </div>

            <div class="form-group row">
                <label for="form-file-order" class="form-label col-form-label-lg">Order-File</label>
                <input type="file" class="form-control form-control-lg" id="form-file-order" name="orderFile">
            </div>


            <div id="colour-option-section" class="uk-grid-column-small uk-grid-row-large uk-child-width-1-3@s uk-text-center pt-3" uk-grid></div>
            <div id="colour-section"></div>

            <div class="form-group row">
                <div class="col p-0">
                    <button type="submit" class="uk-button uk-button-primary">
                        <i class="fa fa-play"></i>
                        Play
                    </button>
                </div>
            </div>
    </div>

    </form>

    </div>

</body>

</html>

<script>

    // https://github.com/jasondavies/newick.js
    function parseNewick(a) {
        for (var e = [], r = {}, s = a.split(/\s*(;|\(|\)|,|:)\s*/), t = 0; t < s.length; t++) {
            var n = s[t];
            switch (n) {
                case "(":
                    var c = {};
                    r.branchset = [c], e.push(r), r = c;
                    break;
                case ",":
                    var c = {};
                    e[e.length - 1].branchset.push(c), r = c;
                    break;
                case ")":
                    r = e.pop();
                    break;
                case ":":
                    break;
                default:
                    var h = s[t - 1];
                    ")" == h || "(" == h || "," == h ? r.name = n : ":" == h && (r.length = parseFloat(n))
            }
        }
        return r

    }

    function generateColorArray(leaves) {
        let leaveContainer = "";
            leaves.forEach(leave => {
                leaveContainer += `
                      <li>
                            ${leave.data.name}
                            <input id="taxa-${leave.data.name}" type="color" name="taxa-color-${leave.data.name}">
                      </li>
                    `; 
            });
        return leaveContainer;
    }


    async function createColorArray(event) {
        const file = event.target.files.item(0)
        const text = await file.text();        
        // document.getElementById("output").innerText = text;
        let newickTrees = text.split("\n");
        let firstNewickTree = newickTrees[0];
        let tree = parseNewick(firstNewickTree);
        let root = d3.hierarchy(tree, d => d.branchset);
        let leaves = root.leaves();

        document.getElementById('colour-option-section').innerHTML += 
        `
        <div>
            <div class="uk-card uk-card-default uk-card-body">Item</div>
        </div>
        <div>
            <div class="uk-card uk-card-default uk-card-body">Item</div>
        </div>
        <div>
            <div class="uk-card uk-card-default uk-card-body">Item</div>
        </div>            
        ` 
        document.getElementById('colour-section').innerHTML += 
        `
        <!-- This is a button toggling the modal with the default close button -->
        <button class="uk-button uk-button-default uk-margin-small-right" type="button" uk-toggle="target: #modal-close-default">Default</button>        
         <!-- This is the modal with the default close button -->
        <div id="modal-close-default" uk-modal>
            <div class="uk-modal-dialog uk-modal-body">
                <button class="uk-modal-close-default" type="button" uk-close></button>
                <h2 class="uk-modal-title">Default</h2>
                ${generateColorArray(leaves)};       
            </div>
        </div>
        `
    }

</script>

<style>
    * {
        font-family: Heebo, sans-serif;
    }

    .icon-right {
        top: calc(50% - 22px);
        font-size: 35px;
        position: relative;
        padding-left: 20px;
    }

    input {
        padding: 0.2em;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .header {
        display: flex;
    }
</style>