# ==============================================================================
#  Phylo-Movies — Docker Compose
#
#  Production (single container):
#    docker compose up --build
#    → http://localhost:8080
#
#  Development (hot-reload frontend + live backend):
#    docker compose --profile dev up --build
#    → Frontend: http://localhost:5173  (Vite HMR)
#    → Backend:  http://localhost:5002  (Flask)
# ==============================================================================

services:
  # ── Production: combined frontend + backend ────────────────────────────────
  app:
    build: .
    ports:
      - "8080:8080"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/about"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 15s

  # ── Development: backend only (use with `npm run dev` on host) ─────────────
  backend-dev:
    build:
      context: .
      dockerfile: docker/Dockerfile.backend
    ports:
      - "5002:5002"
    volumes:
      - ./engine/BranchArchitect:/app/engine/BranchArchitect
    profiles:
      - dev
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5002/about"]
      interval: 15s
      timeout: 5s
      retries: 3
      start_period: 10s
